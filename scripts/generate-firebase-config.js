// scripts/generate-firebase-config.js
// This script runs during the Vercel build process.
// It reads Firebase configuration from Vercel Environment Variables
// and writes it into the assets/firebase/config.js file.

const fs = require('fs');
const path = require('path');

console.log("Starting Firebase config generation...");

// Retrieve environment variables (ensure these are set in Vercel project settings)
const apiKey = process.env.FIREBASE_API_KEY;
const authDomain = process.env.FIREBASE_AUTH_DOMAIN;
const projectId = process.env.FIREBASE_PROJECT_ID;
const storageBucket = process.env.FIREBASE_STORAGE_BUCKET;
const messagingSenderId = process.env.FIREBASE_MESSAGING_SENDER_ID;
const appId = process.env.FIREBASE_APP_ID;
// const measurementId = process.env.FIREBASE_MEASUREMENT_ID; // Uncomment if used

// Basic validation
if (!apiKey || !authDomain || !projectId || !storageBucket || !messagingSenderId || !appId) {
    console.error("Error: Missing one or more Firebase environment variables.");
    console.error("Please ensure FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, etc., are set in Vercel.");
    process.exit(1); // Exit with an error code
}

// Content for the config.js file
const configContent = `// assets/firebase/config.js
// This file is auto-generated during the Vercel build process.
// Do NOT edit this file directly in your deployed application.
// Source of truth is Vercel Environment Variables.

import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "${apiKey}",
    authDomain: "${authDomain}",
    projectId: "${projectId}",
    storageBucket: "${storageBucket}",
    messagingSenderId: "${messagingSenderId}",
    appId: "${appId}"
    // measurementId: "${measurementId}" // Uncomment if you use it and have it set
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

export { app, auth, db };
`;

// Define the output path for config.js
// This script is in /scripts, config.js is in /assets/firebase
const outputPath = path.join(__dirname, '../assets/firebase/config.js');

try {
    // Ensure the directory exists (optional, but good practice)
    const outputDir = path.dirname(outputPath);
    if (!fs.existsSync(outputDir)) {
        fs.mkdirSync(outputDir, { recursive: true });
    }

    fs.writeFileSync(outputPath, configContent.trim());
    console.log(\`Firebase config.js generated successfully at: \${outputPath}\`);
} catch (error) {
    console.error(\`Error writing Firebase config file at \${outputPath}:\`, error);
    process.exit(1); // Exit with an error code
}
